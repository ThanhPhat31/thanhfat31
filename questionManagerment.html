<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- Boxicons -->
		<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css'
			rel='stylesheet'>
		<link rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
			integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
			crossorigin="anonymous">
		<!-- My CSS -->
		<link rel="stylesheet" href="css/style.css">

		<title>Lecturer</title>
	</head>

	<body>


		<!-- SIDEBAR -->
		<section id="sidebar">
			<a href="#" class="brand">
				<i class='bx bxs-smile'></i>
				<span class="text">Lecturer</span>
			</a>
			<ul class="side-menu top">
				<li class="active">
					<a href="questionManagerment.html">
						<i class='bx bxs-dashboard'></i>
						<span class="text">Question Management</span>
					</a>
				</li>
				<li class="">
					<a href="kanji.html">
						<i class='bx bxs-dashboard'></i>
						<span class="text">Kanji Management</span>
					</a>
				</li>
				<li class="">
					<a href="newWord.html">
						<i class='bx bxs-dashboard'></i>
						<span class="text">Vocabulary Management</span>
					</a>
				</li>
				<li class="">
					<a href="gramma.html">
						<i class='bx bxs-dashboard'></i>
						<span class="text">Grammar Management</span>
					</a>
				</li>


			</ul>
			<ul class="side-menu">
				<li>
					<a href="" class="logout" id="logOutLink">
						<i class='bx bxs-log-out-circle'></i>
						<span class="text">Logout</span>
					</a>
				</li>
			</ul>
		</section>
		<!-- SIDEBAR -->



		<!-- CONTENT -->
		<section id="content">
			<!-- NAVBAR -->
			<nav>
				<i class='bx bx-menu'></i>
				<!-- <a href="#" class="nav-link">Categories</a> -->
				<!-- <form action="#">
					<div class="form-input">
						<input type="search" placeholder="Search...">
						<button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
					</div>
				</form> -->
				<!-- <input type="checkbox" id="switch-mode" hidden>
				<label for="switch-mode" class="switch-mode"></label> -->
				<!-- <a href="#" class="notification">
				<i class='bx bxs-bell'></i>
				<span class="num">8</span>
			</a> -->
				<!-- <a href="#" class="profile">
				<img src="img/people.png">
			</a> -->
			</nav>
			<!-- NAVBAR -->

			<!-- MAIN -->
			<main>
				<!-- <div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right'></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul>
				</div>
				<a href="#" class="btn-download">
					<i class='bx bxs-cloud-download'></i>
					<span class="text">Download PDF</span>
				</a>
			</div>

			<ul class="box-info">
				<li>
					<i class='bx bxs-calendar-check'></i>
					<span class="text">
						<h3>1020</h3>
						<p>New Order</p>
					</span>
				</li>
				<li>
					<i class='bx bxs-group'></i>
					<span class="text">
						<h3>2834</h3>
						<p>Visitors</p>
					</span>
				</li>
				<li>
					<i class='bx bxs-dollar-circle'></i>
					<span class="text">
						<h3>$2543</h3>
						<p>Total Sales</p>
					</span>
				</li>
			</ul> -->
				<div class="table-data">
					<div class="order">
						<div class="head">
							<h3>Questions</h3>
							<button type="button" class="btn btn-primary" data-toggle="modal"
								data-target="#addModal">Add question</button>
								<!-- <button type="button" class="btn btn-primary" data-toggle="modal"
								data-target="#addModal2">Add question Type 3</button> -->
							<select class="form-select" id="question-list" aria-label="Select a
								question">
								<option value="">Select lesson questions</option>
							</select>
							<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addModalques" >Add lesson</button> -->
							<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addModal">Add question</button> -->
						</div>
						<div id="question-container">

						</div>


					</div>
				</div>
			</main>
			<div class="modal fade" id="addModal" tabindex="-1" role="dialog"
				aria-labelledby="addModal" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">

						<div class="modal-body">
							<form>
								<div class="mb-3">
									<label for="question" class="form-label">Question:</label>
									<input type="text" class="form-control" id="question" name="question" required>
								</div>
								<div class="mb-3">
									<label for="answer" class="form-label">Answer:</label>
									<input type="text" class="form-control" id="answer" name="answer" required>
								</div>

								<div class="mb-3">
									<label for="answer-choices" class="form-label">Answer Choices:</label>
									<a style="color: red; font-size:small;">★Format đáp án:"a,b,c,d"</a>
									<input type="text" class="form-control" id="answer-choices"
										name="answer-choices" required>
								</div>
								<div class="mb-3">
									<label for="type" class="form-label">Type of Question:</label>
									<select class="form-select" id="type" name="type" required>
										<option value="1">multiple choice</option>
										<option value="2">arrange</option>
									</select>
								</div>
								<div class="mb-3">
									<select class="form-select" id="question-list-1" aria-label="Select a
										question" required>
										<option value="">Select lesson questions</option>
									</select>
								</div>
							</form>


						</div>
						<div class="modal-footer">
							<button type="submit" class="btn btn-secondary" data-dismiss="modal">Close</button>
							<button type="button" class="btn btn-primary submit">Submit</button>
						</div>
					</div>
				</div>
			</div>
<!--
			<div class="modal fade" id="addModal2" tabindex="-1" role="dialog"
				aria-labelledby="addModal" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">

						<div class="modal-body">
							<form>
								<div class="mb-3">
									<label for="question" class="form-label">Question:</label>
									<input type="text" class="form-control" id="question" name="question">
								</div>
								<div class="mb-3">
									<label for="answer" class="form-label">Answer:</label>
									<input type="text" class="form-control" id="answer" name="answer">
								</div>
								<div class="mb-3">
									<label for="answer-choices" class="form-label">Answer Choices:</label>
									<input type="text" class="form-control" id="answer-choices"
										name="answer-choices">
								</div>
								<div class="mb-3">
									<select class="form-select" id="question-list-2" aria-label="Select a
										question">
										<option value="">-- Select a question --</option>
									</select>
								</div>
							</form>


						</div>
						<div class="modal-footer">
							<button type="submit" class="btn btn-secondary" data-dismiss="modal">Close</button>
							<button type="button" class="btn btn-primary submit">Submit</button>
						</div>
					</div>
				</div>
			</div> -->
			<!-- edit modal-->
			<div class="modal fade" id="editModal6" tabindex="-1" role="dialog"
				aria-labelledby="editModal6" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-body">
							<form>
								<div class="mb-3">
									<label for="question" class="form-label">Question:</label>
									<input type="text" class="form-control" id="question-1" name="question" required>
								</div>
								<div class="mb-3">
									<label for="answer" class="form-label">Answer:</label>
									<input type="text" class="form-control" id="answer-2" name="answer" required>
								</div>
								<div class="mb-3">
									<label for="answer-choices" class="form-label">Answer Choices:</label>
									<input type="text" class="form-control" id="answer-choices-3"
										name="answer-choices" required>
								</div>

								<div class="mb-3">
									<label for="type" class="form-label">Type of Question:</label>
									<select class="form-select" id="type-4" name="type" required>
										<option value="1">multiple choice</option>
										<option value="2">arrange</option>
									</select>
								</div>
							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
							<button type="button" class="btn btn-primary save_edited_data_2">Save</button>
						</div>
					</div>

				</div>

			</div>
			<!-- MAIN -->
		</section>
		<!-- CONTENT -->


		<script type="module">
			import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
			import {
				getAuth, signOut
			} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
			import { getDatabase, ref, child, get, set, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";


			// TODO: Add SDKs for Firebase products that you want to use
			// https://firebase.google.com/docs/web/setup#available-libraries

			// Your web app's Firebase configuration
			const firebaseConfig = {
				apiKey: "AIzaSyCa-l4lJ_Ki1gEGgTaPkMNL_dBfCr6-tTo",
				authDomain: "japanesequizappversion2.firebaseapp.com",
				databaseURL: "https://japanesequizappversion2-default-rtdb.asia-southeast1.firebasedatabase.app",
				projectId: "japanesequizappversion2",
				storageBucket: "japanesequizappversion2.appspot.com",
				messagingSenderId: "267581035496",
				appId: "1:267581035496:web:217ceea62de2e63d754a5d",
				measurementId: "G-BC9627MX8C"
			}
			// Initialize Firebase
			const app = initializeApp(firebaseConfig);
			const auth = getAuth();
			const database = getDatabase(app);

			document.getElementById("logOutLink").addEventListener('click', (e) => {
				signOut(auth).then(() => {
					// Sign-out successful.
					console.log('Sign-out successful.');
					alert('Sign-out successful.');
					window.location = "loginAdmin.html";
					//document.getElementById('logOut').style.display = 'none';
				}).catch((error) => {
					// An error happened.
					console.log('An error happened.');
				});
			});


			let tableBody = document.querySelector("tbody");

			$(document).ready(function () {

				const db = getDatabase();
				const questionRef = ref(db, 'questions/bai1');

				const questionRef2 = ref(db, 'questions');
				let nameSelected;
				let session;
				console.log(questionRef2);
				// Lấy danh sách các document trong collection 'questions'
				onValue(questionRef2, function (snapshot) {
					const questions = snapshot.val();
					console.log(questions);
					// Lặp qua tất cả các document và thêm giá trị của trường 'title' vào select box
					let selectBox = document.getElementById('question-list');
					selectBox.innerHTML = '<option value="">Select lesson questions</option>';
					selectBox.addEventListener('change', displayQuestion);

					const keys = Object.keys(questions);
					keys.forEach(key => {
						const option = document.createElement('option');
						option.value = key;
						option.text = key;
						selectBox.appendChild(option);
					});

				});

				// Lấy danh sách các document trong collection 'questions'
				onValue(questionRef2, function (snapshot) {
					const questions = snapshot.val();
					console.log(questions);
					// Lặp qua tất cả các document và thêm giá trị của trường 'title' vào select box
					let selectBox = document.getElementById('question-list-1');
					selectBox.innerHTML = '<option value="">Select lesson questions</option>';
					selectBox.addEventListener('change', displayQuestion1);

					const keys = Object.keys(questions);
					keys.forEach(key => {
						const option = document.createElement('option');
						option.value = key;
						option.text = key;
						selectBox.appendChild(option);
					});

				});

				// Lấy danh sách các document trong collection 'questions'
				onValue(questionRef2, function (snapshot) {
					const questions = snapshot.val();
					console.log(questions);
					// Lặp qua tất cả các document và thêm giá trị của trường 'title' vào select box
					let selectBox = document.getElementById('question-list-2');
					selectBox.innerHTML = '<option value="">Select lesson questions</option>';
					selectBox.addEventListener('change', displayQuestion1);

					const keys = Object.keys(questions);
					keys.forEach(key => {
						const option = document.createElement('option');
						option.value = key;
						option.text = key;
						selectBox.appendChild(option);
					});

				});




				console.log(questionRef);
				// onValue(questionRef, (snapshot) => {
				//     const questions = snapshot.val();
				//     //console.log(snapshot.val());
				//     for (let qs in questions) {
				//         console.log(questions[qs].answermatching);
				//         if (questions[qs].typequestion == 1) {
				//             let tr =
				//                 `<tr data-id="${qs}">
				//                 <td>
				//                     <p>${questions[qs].question}</p>
				//                 </td>
				//                 <td>${questions[qs].answer}</td>

				//                 <td>${questions[qs].answerchose}</td>
				//                 <td>${questions[qs].typequestion}</td>

				//                 <td>
				//                     <button type="button" data-toggle="modal" data-target="#editModal" class="btn btn-outline-dark editButton" >Edit</button>
				//                     <button type="button" class="btn btn-outline-dark deleteButton">Delete</button>
				//                 </td>
				//             </tr>`
				//             tableBody.innerHTML += tr;
				//         }

				//         else if (questions[qs].typequestion == 2) {
				//             let rr =
				//                 `<table>`
				//             for (let index in questions[qs].answerchose) {
				//                 //console.log(questions[qs].answerchose)
				//                 rr += `<tr><td>${questions[qs].answerchose[index]}</td></tr>`

				//             }
				//             rr +=
				//                 `</table>`
				//             let tr =
				//                 `<tr data-id="${qs}">
				//                 <td>
				//                     <p>${questions[qs].question}</p>
				//                 </td>
				//                 <td>${questions[qs].answer}</td>

				//                 <td>${rr}</td>
				//                 <td>${questions[qs].typequestion}</td>

				//                 <td>
				//                     <button type="button" data-toggle="modal" data-target="#editModal" class="btn btn-outline-dark editButton" >Edit</button>
				//                     <button type="button" class="btn btn-outline-dark deleteButton">Delete</button>
				//                 </td>
				//             </tr>`
				//             tableBody.innerHTML += tr;
				//         }
				//         else {
				//             let rr = `<table>`
				//             for (const [key, value] of Object.entries(questions[qs].answermatching)) {
				//                 rr += `<tr><td>${key}: ${value}</td></tr>`;
				//             }
				//             rr += `</table>`
				//             let rt = `<table>`
				//             //for (let index in questions[qs].questionmatching) {
				//             //console.log(questions[qs].questionmatching)

				//             for (const [key, value] of Object.entries(questions[qs].questionmatching)) {
				//                 rt += `<tr><td>${key}: ${value}</td></tr>`;
				//             }

				//             //}
				//             rt += `</table>`

				//             let tr =
				//                 `<tr data-id="${qs}">
				//                 <td>
				//                     <p>${questions[qs].question}</p>
				//                 </td>
				//                 <td>${rr}</td>

				//                 <td>${rt}</td>
				//                 <td>${questions[qs].typequestion}</td>

				//                 <td>
				//                     <button type="button" data-toggle="modal" data-target="#editModal" class="btn btn-outline-dark editButton" >Edit</button>
				//                     <button type="button" class="btn btn-outline-dark deleteButton">Delete</button>
				//                 </td>
				//             </tr>`
				//             tableBody.innerHTML += tr;
				//         }
				//     }

				// });
				function displayQuestion1() {
					nameSelected = this.value;
				}
				function displayQuestion() {
					// Get the selected question ID
					let questionId = this.value;
					const db = getDatabase();
					nameSelected = this.value;
					// Get the question data from the database
					let questionRef = ref(db, 'questions/' + questionId);

					get(questionRef).then((snapshot) => {
						let questionData = snapshot.val();
						console.log(questionData);

						const keys = Object.keys(questionData);
						let questionContainer = document.getElementById('question-container');
						questionContainer.innerHTML = '';

						// Create the table element
						let table = document.createElement('table');
						let thead = document.createElement('thead');
						let tbody = document.createElement('tbody');
						table.appendChild(thead);
						table.appendChild(tbody);

						// Create the table header row
						let headerRow = document.createElement('tr');
						let questionHeader = document.createElement('th');
						questionHeader.innerText = 'Question';
						let answerHeader = document.createElement('th');
						answerHeader.innerText = 'Answer';
						let answerChooseHeader = document.createElement('th');
						answerChooseHeader.innerText = 'Answer Choose';
						let typeHeader = document.createElement('th');
						typeHeader.innerText = 'Type of Question';
						let actionHeader = document.createElement('th');
						actionHeader.innerText = 'Action';
						headerRow.appendChild(questionHeader);
						headerRow.appendChild(answerHeader);
						headerRow.appendChild(answerChooseHeader);
						headerRow.appendChild(typeHeader);
						headerRow.appendChild(actionHeader);
						thead.appendChild(headerRow);

						keys.forEach(key => {
							console.log(key);
							// Create the table row
							let row = document.createElement('tr');
							// Add the question
							let questionCell = document.createElement('td');
							questionCell.innerText = questionData[key].question;
							row.appendChild(questionCell);

							// Add the answer
							let answerCell = document.createElement('td');
							answerCell.innerText = questionData[key].answer;
							row.appendChild(answerCell);

							// Add the answer choices (if applicable)
							let answerChooseCell = document.createElement('td');
							if (questionData[key].answerchose) {
								answerChooseCell.innerText = questionData[key].answerchose.join(', ');
							}
							row.appendChild(answerChooseCell);

							// Add the type of question
							let typeCell = document.createElement('td');
							typeCell.innerText = questionData[key].typequestion;
							row.appendChild(typeCell);

							// Add the action button
							let actionCell = document.createElement('td');
							let deleteButton = document.createElement('button');
							deleteButton.innerText = 'Delete';
							deleteButton.addEventListener('click', () => {
								var confirmation = confirm("Do you want to delete this object?");
								if(confirmation) {
									// Delete the question from the database
									session = Object.keys(questionData)[Array.from(tbody.children).indexOf(row)];
									let questionRef = ref(db, 'questions/' + nameSelected + "/" + session);
									remove(questionRef);
									// Remove the row from the table
									row.remove();
									window.location.reload();
								}
							});
							actionCell.appendChild(deleteButton);
							row.appendChild(actionCell);

							// Add the action buttons
							let editButton = document.createElement('button');
							editButton.innerText = 'Edit';
							editButton.addEventListener('click', () => {
								// Handle the edit button click event
								// ...
								let rowData = row.cells;
								// Populate the modal with the row data
								let questionInput = document.getElementById('question-1');
								questionInput.value = rowData[0].innerText;
								let answerInput = document.getElementById('answer-2');
								answerInput.value = rowData[1].innerText;
								let answerChoicesInput = document.getElementById('answer-choices-3');
								answerChoicesInput.value = rowData[2].innerText;
								let typeInput = document.getElementById('type-4');
								typeInput.value = rowData[3].innerText;

								session = Object.keys(questionData)[Array.from(tbody.children).indexOf(row)];
								console.log(key);
								$('#editModal6').modal('show');
							});
							actionCell.appendChild(editButton);

							// Add the row to the table body
							tbody.appendChild(row);
						});

						// Add the table to the question container
						questionContainer.appendChild(table);
					});
				}

				// get(child(dbRef, `Users/`)).then((snapshot) => {

				//     const Users = snapshot.val();
				//     for (let user in Users) {
				//          //console.log(snapshot.key);
				//         let tr =
				//             `<tr data-id="${user}">
				//         <td>
				//             <p>${Users[user].fullName}</p>
				//         </td>
				//         <td>${Users[user].date}</td>
				//         <td>${Users[user].gender}</td>
				//         <td>${Users[user].phoneNo}</td>
				//         <td>${Users[user].email}</td>
				//         <td>${Users[user].userName}</td>
				//         <td>${Users[user].passWord}</td>
				//         <td>${Users[user].otp}</td>
				//         <td>
				//             <button type="button" data-toggle="modal" data-target="#editModal" class="btn btn-outline-dark editButton" >Edit</button>
				//             <button type="button" class="btn btn-outline-dark">Delete</button>
				//         </td>
				//     </tr>`
				//         tableBody.innerHTML += tr;
				//     }
				// }).catch((error) => {
				//     console.log(error);
				// });
				$("#addModal .submit").on("click", () => {

					let question = document.getElementById('question').value;
					let answer = document.getElementById('answer').value.replace(/ /g,'');
					let answerChoices = document.getElementById('answer-choices').value.split(',').map((e) => e.replace(/\s/g, ''));
					let type = document.getElementById('type').value.replace(/ /g,'');
					let questionId = this.value;
					// console.log(questionId);
					// console.log(answerChoices);

					if (question && answer && answerChoices.length && type && nameSelected) {
						if (type === '1') {
							if (!answerChoices.includes(answer.trim())) {
								alert('Answer is not in Answer Choices!');
								return;
							}
							if(answerChoices.length > 4) {
								alert('Invalid length: Answer choices should have at most 3 commas');
								return;
							}

							const isAllUniqueItems = answerChoices.every((value, index, arr) => {
								return arr.indexOf(value) === index;
							});

							if(isAllUniqueItems != true) {
								alert('Invalid input: Duplicate answer choice');
								return;
							};


						} else {
							let answerChoicesString = answerChoices.toString();
							if (answerChoicesString.split(',').length > 4) {
								alert('Invalid input: Answer choices should have at most 3 commas');
								return;
							}

							// remove all space
							const shorterAnswer = answer.replace(/\s/g, '')
							// check length
							if (shorterAnswer.length !== answerChoices.join('').length) {
								alert('Your answer is not correct')
								return;
							}
							// if every element of answerChoices is existed in shorterAnswer
							if (!answerChoices.every((e) => shorterAnswer.includes(e))) {
								alert('Your answer is not correct 1')
								return;
							}

							const isAllUniqueItems = answerChoices.every((value, index, arr) => {
								return arr.indexOf(value) === index;
							});

							if(isAllUniqueItems != true) {
								alert('Invalid input: Duplicate answer choice');
								return;
							};
						}


						let questionRef = ref(db, 'questions/' + nameSelected);
						get(questionRef).then((snapshot) => {
							let questionData2 = snapshot.val();

							// // Add the new question to the database
							let newQuestionRef = ref(db, 'questions/' + nameSelected + "/" + "question" + (Object.keys(questionData2).length + 1));
							console.log(newQuestionRef)
							set(newQuestionRef, {
								question: question,
								answer: answer,
								answerchose: answerChoices,
								typequestion: type
							}).then(() => {
								alert('Add a new question successfully !');
								$('#addModal').modal('hide');
								window.location.reload();
							})
									.catch((error) => {
										alert('Error create: ', error);
									});
							;

							console.log({
								question: question,
								answer: answer,
								answerchose: answerChoices,
								typequestion: type
							})
						});
					} else {
						alert("Please fill out all required fields.");
					}


				})

				$("#addModal1 .submit").on("click", () => {
					alert("đã vô");

					let question = document.getElementById('question').value;
					let answer = document.getElementById('answer').value;
					let answerChoices = document.getElementById('answer-choices').value.split(',');
					let type = document.getElementById('type').value;
					let questionId = this.value;
					console.log('type', type);

					if (question && answer && answerChoices.length && type && nameSelected) {
						// Add the new question to the database
						let newQuestionRef = push(ref(db, 'questions/' + nameSelected));
						set(newQuestionRef, {
							question: question,
							answer: answer,
							answerchose: answerChoices,
							typequestion: type
						});

						console.log({
							question: question,
							answer: answer,
							answerchose: answerChoices,
							typequestion: type
						})

						// // Close the modal
						// let modal = document.getElementById('add-question-modal');
						// let modalInstance = bootstrap.Modal.getInstance(modal);
						// modalInstance.hide();
						window.location.reload();
					} else {
						alert("Please fill out all required fields.");
					}
				})



				// $(document).on("click", ".editButton", function () {
				//     var postKey = $(this).parent().parent().data("id");
				//     var postRef = ref(db, 'Users/' + postKey);
				//     const dbRef = ref(db);
				//     //console.log(postKey);
				//     get(child(dbRef, "Users/" + postKey)).then((snapshot => {
				//         if (snapshot.exists()) {

				//             $("#editModal .edit_show_name").val(snapshot.val().fullName);
				//             $("#editModal .edit_show_date").val(changedateformat1(snapshot.val().date));
				//             $("#editModal .edit_show_gender").val(snapshot.val().gender);
				//             $("#editModal .edit_show_phone").val(snapshot.val().phoneNo);
				//             $("#editModal .edit_show_email").val(snapshot.val().email);
				//             $("#editModal .edit_show_userName").val(snapshot.val().userName);
				//             $("#editModal .edit_show_pass").val(snapshot.val().passWord);
				//             $("#editModal .edit_show_status").val(snapshot.val().otp);
				//             $(".edit_key").val(postKey);
				//         }
				//         else {
				//             alert("no data found");
				//         }
				//     }))
				//         .catch((error) => {
				//             alert("loi roi" + error);
				//         })

				// })

				$(".save_edited_data_2").on("click", (event) => {
					event.preventDefault();
					let question = document.getElementById('question-1').value;
					let answer = document.getElementById('answer-2').value.replace(/ /g,'');
					let answerChoices = document.getElementById('answer-choices-3').value.split(',').map((e) => e.replace(/\s/g, ''))
					let type = document.getElementById('type-4').value.replace(/ /g,'');
					let questionId = this.value;
					// Add the new question to the database
					if (question && answer && answerChoices.length && type && nameSelected) {
						if (type === '1') {
							if (!answerChoices.includes(answer.trim())) {
								alert('Answer is not in Answer Choices!');
								return;
							}
							if(answerChoices.length > 4) {
								alert('Invalid length: Answer choices should have at most 3 commas');
								return;
							}

							const isAllUniqueItems = answerChoices.every((value, index, arr) => {
								return arr.indexOf(value) === index;
							});

							if(isAllUniqueItems != true) {
								alert('Invalid input: Duplicate answer choice');
								return;
							};


						} else {
							let answerChoicesString = answerChoices.toString();
							if (answerChoicesString.split(',').length > 4) {
								alert('Invalid input: Answer choices should have at most 3 commas');
								return;
							}

							// remove all space
							const shorterAnswer = answer.replace(/\s/g, '')
							// check length
							if (shorterAnswer.length !== answerChoices.join('').length) {
								alert('Your answer is not correct')
								return;
							}
							// if every element of answerChoices is existed in shorterAnswer
							if (!answerChoices.every((e) => shorterAnswer.includes(e))) {
								alert('Your answer is not correct 1')
								return;
							}

							const isAllUniqueItems = answerChoices.every((value, index, arr) => {
								return arr.indexOf(value) === index;
							});

							if(isAllUniqueItems != true) {
								alert('Invalid input: Duplicate answer choice');
								return;
							};
						}

						const db = getDatabase();
						let newQuestionRef = ref(db, 'questions/' + nameSelected + "/" + session);
						console.log(newQuestionRef);

						update(newQuestionRef, {
							question: question,
							answer: answer,
							answerchose: answerChoices,
							typequestion: type
						})
								.then(() => {
									alert('Edit success !');
									$('#editModal6').modal('hide');
									window.location.reload();

								})
								.catch((error) => {
									alert('Error updating: ', error);
								});

						console.log({
							question: question,
							answer: answer,
							answerchose: answerChoices,
							typequestion: type
						})

						// // Close the modal
						// let modal = document.getElementById('add-question-modal');
						// let modalInstance = bootstrap.Modal.getInstance(modal);
						// modalInstance.hide();
					} else {
						alert("Please fill out all required fields.");
					}
				})

				$(document).on("click", ".deleteButton", function () {
					var delete_key = $(this).parent().parent().data("id");
					var confirmation = confirm("Are you sure want to delete ?");
					if(confirmation) {
						remove(child(dbRef, "Users/" + delete_key));
						$(this).parent().parent().hide();
					}
				})
			})












			const allSideMenu = document.querySelectorAll('#sidebar .side-menu.top li a');

			allSideMenu.forEach(item => {
				const li = item.parentElement;

				item.addEventListener('click', function () {
					allSideMenu.forEach(i => {
						i.parentElement.classList.remove('active');
					})
					li.classList.add('active');
				})
			});



			// TOGGLE SIDEBAR
			const menuBar = document.querySelector('#content nav .bx.bx-menu');
			const sidebar = document.getElementById('sidebar');

			menuBar.addEventListener('click', function () {
				sidebar.classList.toggle('hide');
			})



			const searchButton = document.querySelector('#content nav form .form-input button');
			const searchButtonIcon = document.querySelector('#content nav form .form-input button .bx');
			const searchForm = document.querySelector('#content nav form');

			searchButton.addEventListener('click', function (e) {
				if (window.innerWidth < 576) {
					e.preventDefault();
					searchForm.classList.toggle('show');
					if (searchForm.classList.contains('show')) {
						searchButtonIcon.classList.replace('bx-search', 'bx-x');
					} else {
						searchButtonIcon.classList.replace('bx-x', 'bx-search');
					}
				}
			})


			if (window.innerWidth < 768) {
				sidebar.classList.add('hide');
			} else if (window.innerWidth > 576) {
				searchButtonIcon.classList.replace('bx-x', 'bx-search');
				searchForm.classList.remove('show');
			}


			window.addEventListener('resize', function () {
				if (this.innerWidth > 576) {
					searchButtonIcon.classList.replace('bx-x', 'bx-search');
					searchForm.classList.remove('show');
				}
			})



			const switchMode = document.getElementById('switch-mode');

			switchMode.addEventListener('change', function () {
				if (this.checked) {
					document.body.classList.add('dark');
				} else {
					document.body.classList.remove('dark');
				}
			})

		</script>
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
			integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
			crossorigin="anonymous"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
			integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
			crossorigin="anonymous"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
			integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
			crossorigin="anonymous"></script>
	</body>

</html>
